{% extends "base.html" %}
{% block content %}

<style>
.ws-container {
    max-width: 1100px;
    margin: auto;
    padding: 80px 20px;
    color: #4b1e1e;
}

.ws-container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 30px 20px 60px;
}

.ws-card {
    background: rgba(255, 255, 255, 0.55);
    border-radius: 22px;
    padding: 40px;
    box-shadow: 0 14px 32px rgba(0,0,0,0.1);
}

.ws-grid {
    display: grid;
    grid-template-columns: 1.3fr 1fr;
    gap: 45px;
}

.form-group {
    margin-bottom: 22px;
}

.form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 6px;
}

.pretty-select,
.pretty-input {
    width: 100%;
    padding: 12px 14px;
    border-radius: 12px;
    border: 1px solid #d8a79b;
}

.file-box {
    background: #fff;
    border-radius: 12px;
    padding: 10px;
    border: 1px dashed #d8a79b;
}

.generate-btn {
    margin-top: 55px;
    display: flex;
    justify-content: center;
}

.generate-btn button {
    background: linear-gradient(135deg, #7a1f2b, #a83246);
    border: none;
    color: white;
    padding: 14px 40px;
    font-size: 16px;
    font-weight: 600;
    border-radius: 999px;
    cursor: pointer;
    box-shadow: 0 8px 20px rgba(122, 31, 43, 0.35);
}
.ws-card.secondary {
    margin-top: 30px;
    background: rgba(255, 255, 255, 0.65);
    border: 2px dashed #d8a79b;
}

.ws-card.secondary h3 {
    font-size: 20px;
    margin-bottom: 20px;
    font-weight: 700;
}

.checkbox-group {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 12px;
}
.or-divider {
    display: flex;
    align-items: center;
    gap: 18px;
    margin: 30px 0;
    color: #8a4a4a;
    font-weight: 600;
}

.or-divider::before,
.or-divider::after {
    content: "";
    flex: 1;
    height: 1px;
    background: #d8a79b;
}
.generate-btn button:disabled {
    background: linear-gradient(135deg, #cfa5a5, #e6bcbc);
    cursor: not-allowed;
    opacity: 0.7;
}
.answer-key-bar {
    max-width: 1100px;
    margin: 25px auto 10px;
    padding: 14px 22px;
    background: rgba(255, 255, 255, 0.6);
    border-radius: 14px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.08);
}

.answer-key-bar .checkbox-group {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 600;
}

</style>

<div class="ws-container">

<h1>Math Worksheet Generator ðŸ§ </h1>

<form
    method="POST"
    action="{{ url_for('generate_worksheet') }}"
    enctype="multipart/form-data"
>

<div class="ws-card">
<div class="ws-grid">

<!-- LEFT -->
<!-- LEFT -->
<div>

    <!-- GRADE (LOCKED) -->
    <div class="form-group">
        <label>Grade</label>
        <input
            type="text"
            class="pretty-input"
            value="{{ current_user.grade }}"
            disabled
        >
        <input type="hidden" name="grade" id="grade" value="{{ current_user.grade }}">
    </div>

    <!-- BOARD (LOCKED) -->
    <div class="form-group">
        <label>Board</label>
        <input
            type="text"
            class="pretty-input"
            value="{{ current_user.board }}"
            disabled
        >
        <input type="hidden" name="board" id="board" value="{{ current_user.board }}">
    </div>

    <!-- TOPIC -->
    <div class="form-group">
        <label>Topic</label>
        <select class="pretty-select" name="topic" id="topic" required disabled>
            <option value="">Loading topics...</option>
        </select>
    </div>

    <!-- SUB TOPIC -->
    <div class="form-group">
        <label>Sub-Topic (Optional)</label>
        <input class="pretty-input" name="subtopic" placeholder="e.g. Linear Equations">
    </div>

</div>


<!-- RIGHT -->
<div>
    <div class="form-group">
        <label>Difficulty</label>
        <select class="pretty-select" name="difficulty">
            <option value="Easy">Easy</option>
            <option value="Medium">Medium</option>
            <option value="Hard">Hard</option>
        </select>
    </div>

    <div class="form-group">
        <label>Download As</label>
        <select class="pretty-select" name="format">
            <option value="pdf">PDF</option>
            <option value="docx">DOCX</option>
            <option value="txt">TXT</option>
            <option value="jpg">JPG</option>
            <option value="png">PNG</option>
            <option value="gif">GIF</option>
        </select>
    </div>

</div>

</div>
</div>

<!-- OR DIVIDER -->
<div class="or-divider">OR</div>


<!-- SECOND BOX -->
<div class="ws-card secondary">

<h3>Existing Worksheet Options</h3>

<div class="form-group">
    <label>Upload Existing Worksheet</label>
    <input type="file" class="file-box" name="worksheet_file">
</div>

</div>

<!-- COMMON ANSWER KEY OPTION -->
<!-- COMMON ANSWER KEY OPTION (THIN) -->
<div class="answer-key-bar">
    <label class="checkbox-group">
        <input type="checkbox" name="answer_key" value="1">
        Include Answer Key
    </label>
</div>




<div class="generate-btn">
    <button type="submit" id="generateBtn" disabled>
    âœ¨ Generate Worksheet
</button>
</div>

</form>
</div>

<!-- âœ… TOPIC AUTO-LOAD SCRIPT -->
<script>
async function loadTopics() {
    const grade = document.querySelector("input[name='grade']").value;
    const board = document.querySelector("input[name='board']").value;

    const topicSelect = document.getElementById("topic");

    topicSelect.innerHTML = "<option>Loading topics...</option>";
    topicSelect.disabled = true;

    if (!grade || !board) {
        topicSelect.innerHTML = "<option>Select Grade & Board first</option>";
        return;
    }

    try {
        const res = await fetch(`/get-topics?grade=${grade}&board=${board}`);
        if (!res.ok) throw new Error("Failed to fetch topics");

        const topics = await res.json();

        topicSelect.innerHTML = "<option value=''>Select Topic</option>";

        if (topics.length === 0) {
            topicSelect.innerHTML = "<option>No topics found</option>";
            return;
        }

        topics.forEach(t => {
            const opt = document.createElement("option");
            opt.value = t;
            opt.textContent = t;
            topicSelect.appendChild(opt);
        });

        topicSelect.disabled = false;
        checkFormValidity();

    } catch (err) {
        console.error(err);
        topicSelect.innerHTML = "<option>Error loading topics</option>";
    }
}

document.addEventListener("DOMContentLoaded", () => {
    loadTopics();
});
</script>
<script>
const grade = document.getElementById("grade");
const board = document.getElementById("board");
const topic = document.getElementById("topic");
const difficulty = document.querySelector("select[name='difficulty']");
const format = document.querySelector("select[name='format']");
const worksheetFile = document.querySelector("input[name='worksheet_file']");
const generateBtn = document.getElementById("generateBtn");

function checkFormValidity() {

    // Flow A: Normal worksheet generation
    const normalFlowValid =
        grade.value &&
        board.value &&
        topic.value &&
        difficulty.value &&
        format.value;

    // Flow B: Upload worksheet
    const uploadFlowValid =
        worksheetFile.files.length > 0;

    // Enable if either flow is valid
    generateBtn.disabled = !(normalFlowValid || uploadFlowValid);
}

// Listen to changes
[
    grade,
    board,
    topic,
    difficulty,
    format,
    worksheetFile
].forEach(el => {
    el.addEventListener("change", checkFormValidity);
});
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const grade = document.getElementById("grade").value;
    const board = document.getElementById("board").value;

    if (grade && board) {
        loadTopics();
    }
});
</script>



{% endblock %}
