{% extends "base.html" %}
{% block content %}

<style>
.ws-container {
    max-width: 1100px;
    margin: auto;
    padding: 80px 20px;
    color: #4b1e1e;
}

.ws-container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 30px 20px 60px;
}

.ws-card {
    background: rgba(255, 255, 255, 0.55);
    border-radius: 22px;
    padding: 40px;
    box-shadow: 0 14px 32px rgba(0,0,0,0.1);
}
.vertical-or {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    color: #8a4a4a;
    gap: 12px;
}

.vertical-or::before,
.vertical-or::after {
    content: "";
    width: 1px;
    flex: 1;
    background: #d8a79b;
}

.ws-grid {
    display: grid;
    grid-template-columns: 1.3fr auto 1fr; /* LEFT | OR | RIGHT */
    gap: 35px;
    align-items: stretch;
}
@media (max-width: 900px) {
    .ws-grid {
        grid-template-columns: 1fr;
    }

    .vertical-or {
        flex-direction: row;
    }

    .vertical-or::before,
    .vertical-or::after {
        width: 40px;
        height: 1px;
    }
}



.form-group {
    margin-bottom: 22px;
}

.form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 6px;
}

.pretty-select,
.pretty-input {
    width: 100%;
    padding: 12px 14px;
    border-radius: 12px;
    border: 1px solid #d8a79b;
}

.file-box {
    background: #fff;
    border-radius: 12px;
    padding: 10px;
    border: 1px dashed #d8a79b;
}

.generate-btn {
    margin-top: 55px;
    display: flex;
    justify-content: center;
}

.generate-btn button {
    background: linear-gradient(135deg, #7a1f2b, #a83246);
    border: none;
    color: white;
    padding: 14px 40px;
    font-size: 16px;
    font-weight: 600;
    border-radius: 999px;
    cursor: pointer;
    box-shadow: 0 8px 20px rgba(122, 31, 43, 0.35);
}
.ws-card.secondary {
    margin-top: 30px;
    background: rgba(255, 255, 255, 0.65);
    border: 2px dashed #d8a79b;
}

.ws-card.secondary h3 {
    font-size: 20px;
    margin-bottom: 20px;
    font-weight: 700;
}

.checkbox-group {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 12px;
}
.or-divider {
    display: flex;
    align-items: center;
    gap: 18px;
    margin: 30px 0;
    color: #8a4a4a;
    font-weight: 600;
}

.or-divider::before,
.or-divider::after {
    content: "";
    flex: 1;
    height: 1px;
    background: #d8a79b;
}
.generate-btn button:disabled {
    background: linear-gradient(135deg, #cfa5a5, #e6bcbc);
    cursor: not-allowed;
    opacity: 0.7;
}
.answer-key-bar {
    max-width: 600px;          /* ðŸ‘ˆ narrower looks better */
    margin: 25px auto;         /* ðŸ‘ˆ centers it horizontally */
    padding: 16px 24px;
    font-weight: 700;     /* ðŸ‘ˆ bold */
    font-size: 16px;      /* ðŸ‘ˆ slightly stronger presence */
    color: #5a1f1f;       
    background: rgba(255, 255, 255, 0.6);
    border-radius: 14px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.08);
    display: flex;             /* ðŸ‘ˆ center contents */
    justify-content: center;
}
.answer-key-bar .checkbox-group {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transform: scale(1.1);
}

.upload-card {
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.upload-zone {
    border: 2px dashed #d8a79b;
    border-radius: 18px;
    padding: 30px 20px;
    text-align: center;
    background: rgba(255,255,255,0.4);
}

.upload-icon {
    font-size: 36px;
    margin-bottom: 10px;
}

.upload-title {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 6px;
}

.upload-subtext {
    font-size: 13px;
    color: #7a4a4a;
    margin-bottom: 18px;
}

.upload-btn {
    display: inline-block;
    padding: 10px 18px;
    border-radius: 999px;
    background: linear-gradient(135deg, #7a1f2b, #a83246);
    color: white;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    margin-bottom: 14px;
}

.upload-btn:hover {
    opacity: 0.95;
}

.upload-hint {
    font-size: 12px;
    color: #8a5a5a;
}


</style>

<div class="ws-container">

<h1>Math Worksheet Generator ðŸ§ </h1>

<form
    method="POST"
    action="{{ url_for('generate_worksheet') }}"
    enctype="multipart/form-data"
>

<div class="ws-card">
    <div class="ws-grid">

        <!-- LEFT: GENERATE NEW WORKSHEET -->
        <div>

            <!-- GRADE -->
            <div class="form-group">
                <label>Grade</label>
                <input class="pretty-input" value="{{ current_user.grade }}" disabled>
                <input type="hidden" name="grade" id="grade" value="{{ current_user.grade }}">
            </div>

            <!-- BOARD -->
            <div class="form-group">
                <label>Board</label>
                <input class="pretty-input" value="{{ current_user.board }}" disabled>
                <input type="hidden" name="board" id="board" value="{{ current_user.board }}">
            </div>

            <!-- TOPIC -->
            <div class="form-group">
                <label>Topic</label>
                <select class="pretty-select" name="topic" id="topic" required disabled>
                    <option value="">Loading topics...</option>
                </select>
            </div>

            <!-- SUB TOPIC -->
            <div class="form-group">
    <label>Select Subtopic</label>
    <select class="pretty-select" name="subtopic" id="subtopic" disabled>
        <option value="">Select Sub-Topic</option>
    </select>
</div>


            <!-- DIFFICULTY -->
            <div class="form-group">
                <label>Difficulty</label>
                <select class="pretty-select" name="difficulty">
                    <option value="Easy">Easy</option>
                    <option value="Medium">Medium</option>
                    <option value="Hard">Hard</option>
                </select>
            </div>

            <!-- DOWNLOAD FORMAT -->
            <div class="form-group">
                <label>Download As</label>
                <select class="pretty-select" name="format">
                    <option value="pdf">PDF</option>
                    <option value="docx">DOCX</option>
                    <option value="txt">TXT</option>
                    <option value="jpg">JPG</option>
                    <option value="png">PNG</option>
                    <option value="gif">GIF</option>
                </select>
            </div>

        </div>

        <div class="vertical-or">OR</div>


        <!-- RIGHT: UPLOAD EXISTING WORKSHEET ONLY -->
        <div class="ws-card secondary upload-card">
    <h3>Existing Worksheet</h3>

    <div class="upload-zone">
        <div class="upload-icon">ðŸ“„</div>

        <p class="upload-title">Upload an existing worksheet</p>
        <p class="upload-subtext">
            Supported formats: PDF, DOCX, JPG, PNG
        </p>

        <label class="upload-btn">
            Choose File
            <input type="file" name="worksheet_file" hidden>
        </label>

        <p class="upload-hint">
            Weâ€™ll analyze your worksheet and generate a refined version.
        </p>
    </div>
</div>

    </div>
</div>


<!-- COMMON ANSWER KEY OPTION -->
<!-- COMMON ANSWER KEY OPTION (THIN) -->
<div class="answer-key-bar">
    <label class="checkbox-group">
        <input type="checkbox" name="answer_key" value="1">
        Include Answer Key
    </label>
</div>




<div class="generate-btn">
    <button type="submit" id="generateBtn" disabled>
    âœ¨ Generate Worksheet
</button>
</div>

</form>
</div>

<!-- âœ… TOPIC AUTO-LOAD SCRIPT -->
<script>
async function loadTopics() {
    const grade = document.querySelector("input[name='grade']").value;
    const board = document.querySelector("input[name='board']").value;

    const topicSelect = document.getElementById("topic");

    topicSelect.innerHTML = "<option>Loading topics...</option>";
    topicSelect.disabled = true;

    if (!grade || !board) {
        topicSelect.innerHTML = "<option>Select Grade & Board first</option>";
        return;
    }

    try {
        const res = await fetch(`/get-topics?grade=${grade}&board=${board}`);
        if (!res.ok) throw new Error("Failed to fetch topics");

        const topics = await res.json();

        topicSelect.innerHTML = "<option value=''>Select Topic</option>";

        if (topics.length === 0) {
            topicSelect.innerHTML = "<option>No topics found</option>";
            return;
        }

        topics.forEach(t => {
            const opt = document.createElement("option");
            opt.value = t;
            opt.textContent = t;
            topicSelect.appendChild(opt);
        });

        topicSelect.disabled = false;
        checkFormValidity();

    } catch (err) {
        console.error(err);
        topicSelect.innerHTML = "<option>Error loading topics</option>";
    }
}

document.addEventListener("DOMContentLoaded", () => {
    loadTopics();
});

</script>
<script>
const grade = document.getElementById("grade");
const board = document.getElementById("board");
const topic = document.getElementById("topic");
const difficulty = document.querySelector("select[name='difficulty']");
const format = document.querySelector("select[name='format']");
const worksheetFile = document.querySelector("input[name='worksheet_file']");
const generateBtn = document.getElementById("generateBtn");

function checkFormValidity() {

    // Flow A: Normal worksheet generation
    const normalFlowValid =
        grade.value &&
        board.value &&
        topic.value &&
        difficulty.value &&
        format.value;

    // Flow B: Upload worksheet
    const uploadFlowValid =
        worksheetFile.files.length > 0;

    // Enable if either flow is valid
    generateBtn.disabled = !(normalFlowValid || uploadFlowValid);
}

// Listen to changes
[
    grade,
    board,
    topic,
    difficulty,
    format,
    worksheetFile
].forEach(el => {
    el.addEventListener("change", checkFormValidity);
});
</script>
<script>
const topicSelect = document.getElementById("topic");
const subTopicSelect = document.getElementById("subtopic");

async function loadSubTopics() {
    const grade = document.getElementById("grade").value;
    const board = document.getElementById("board").value;
    const majorTopic = topicSelect.value;

    subTopicSelect.innerHTML = "<option>Loading sub-topics...</option>";
    subTopicSelect.disabled = true;

    if (!majorTopic) {
        subTopicSelect.innerHTML =
            "<option value=''>Select Sub-Topic (Optional)</option>";
        return;
    }

    try {
        const res = await fetch(
            `/get-minor-topics?grade=${grade}&board=${board}&subject=mathematics&major_topic=${encodeURIComponent(majorTopic)}`
        );

        const data = await res.json();

        subTopicSelect.innerHTML =
            "<option value=''>Select Sub-Topic (Optional)</option>";

        if (data.length === 0) {
            subTopicSelect.innerHTML =
                "<option value=''>No sub-topics available</option>";
            return;
        }

        data.forEach(sub => {
            const opt = document.createElement("option");
            opt.value = sub;
            opt.textContent = sub;
            subTopicSelect.appendChild(opt);
        });

        subTopicSelect.disabled = false;

    } catch (err) {
        console.error(err);
        subTopicSelect.innerHTML =
            "<option value=''>Error loading sub-topics</option>";
    }
}

topicSelect.addEventListener("change", loadSubTopics);
</script>





{% endblock %}
