{% extends "base.html" %}
{% block content %}

{% set errors = errors or {} %}
{% set form = form or {} %}

<style>
/* ---------- REGISTER WRAPPER ---------- */
.register-wrapper {
    display: flex;
    justify-content: center;
    padding: 60px 20px;
}

.register-card {
    width: 100%;
    max-width: 600px;
    background: rgba(255, 255, 255, 0.18);
    backdrop-filter: blur(8px);
    border-radius: 16px;
    padding: 35px 40px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
}

.register-card h2 {
    text-align: center;
    font-weight: 700;
    margin-bottom: 30px;
}

/* ---------- FORM GROUP ---------- */
.form-group {
    margin-bottom: 18px;
}

.form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 6px;
}

/* Inputs */
.form-group input,
.form-group select {
    width: 100%;
    padding: 12px 14px;
    border-radius: 8px;
    border: 1.5px solid transparent;
    outline: none;
    font-size: 15px;
    background: #fff;
    transition: border 0.2s ease, box-shadow 0.2s ease;
}

/* Focus */
.form-group input:focus,
.form-group select:focus {
    border-color: #c44536;
    box-shadow: 0 0 0 2px rgba(196, 69, 54, 0.15);
}

/* ‚ùå ERROR INPUT HIGHLIGHT */
.input-error {
    border-color: #e63946 !important;
    box-shadow: 0 0 0 2px rgba(230, 57, 70, 0.15);
}

/* ---------- PHONE GROUP ---------- */

.phone-group {
    display: flex;
    gap: 10px;
}

.phone-group select {
    width: 90px;        /* fixed country code size */
    flex-shrink: 0;
}

.phone-group input {
    flex: 1;            /* phone number fills remaining space */
}


/* ---------- ERROR TEXT ---------- */
.error-text {
    color: #b91c1c;
    font-size: 13px;
    margin-top: 4px;
    font-weight: 500;
}

/* ---------- REGISTER BUTTON ---------- */
.register-btn {
    width: 100%;
    margin-top: 25px;
    padding: 14px;
    font-size: 16px;
    font-weight: 700;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    background: linear-gradient(135deg, #9e2a2b, #c44536);
    color: white;
}

.register-btn:hover {
    opacity: 0.95;
}

/* ---------- OR DIVIDER ---------- */
.or-divider {
    text-align: center;
    margin: 18px 0;
    font-size: 14px;
    font-weight: 600;
    color: #7a3a3a;
}

/* ---------- GOOGLE BUTTON ---------- */
.google-btn {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 12px;
    border-radius: 10px;
    font-size: 15px;
    font-weight: 600;
    text-decoration: none;
    background: #ffffff;
    color: #333;
    border: 1px solid #ddd;
}

.google-btn:hover {
    background: #f5f5f5;
}

.google-btn img {
    width: 18px;
    height: 18px;
}
/* ---------- CHECKBOX STYLE ---------- */
.checkbox-label {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 600;
    font-size: 14px;
    color: #5a2a2a;
    cursor: pointer;
}

.checkbox-label input[type="checkbox"] {
    width: 16px;
    height: 16px;
    accent-color: #c44536;
    cursor: pointer;
}

.checkbox-label span {
    line-height: 1;
}
.checkbox-label {
    opacity: 0.9;
}
.required {
    color: #e63946; 
    font-weight: 700;
    margin-left: 4px;
    font-size: 14px;
}
.checkbox-group {
    margin-top: 12px;
}

.checkbox-label {
    display: flex;
    align-items: center;   /* üîë fixes vertical misalignment */
    gap: 10px;
    font-size: 14px;
    font-weight: 600;
    color: #5a2a2a;
    cursor: pointer;
}

.checkbox-label input[type="checkbox"] {
    margin: 0;            /* üîë removes default browser offset */
    width: 16px;
    height: 16px;
    accent-color: #c44536;
    cursor: pointer;
}

</style>

<div class="register-wrapper">
    <div class="register-card">

        <h2>Create Account</h2>
        <p style="font-size:13px;color:#7a3a3a;margin-bottom:15px;">
            Fields marked with <span class="required">*</span> are mandatory
        </p>

        {% if errors.get('general') %}
            <div class="error-text" style="margin-bottom:12px;">
                {{ errors['general'] }}
            </div>
        {% endif %}

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div style="padding:10px;border-radius:6px;font-size:14px;background:#ffe6e6;color:#8a1f1f;margin-bottom:10px;">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
        {% endwith %}

        <form method="POST" action="{{ url_for('register') }}">

            <!-- NAME -->
            <div class="form-group">
                <label>Full Name <span class="required">*</span></label>
                <input type="text" name="name" value="{{ form.get('name','') }}" required>
                {% if errors.name %}<div class="error-text">{{ errors.name }}</div>{% endif %}
            </div>

            <!-- EMAIL -->
            <div class="form-group">
                <label>Email <span class="required">*</span></label>
                <input type="email" name="email" value="{{ form.get('email','') }}" required>
                {% if errors.email %}<div class="error-text">{{ errors.email }}</div>{% endif %}
            </div>

            <!-- PHONE -->
            <div class="form-group">
                <label>Mobile Number <span class="required">*</span></label>
                <div class="phone-group">
                    <select name="country_code">
                        {% for code in ['+91','+1','+44'] %}
                        <option value="{{ code }}" {% if form.get('country_code') == code %}selected{% endif %}>{{ code }}</option>
                        {% endfor %}
                    </select>

                    <input type="text"
                        name="phone_number_main"
                        inputmode="numeric"
                        maxlength="10"
                        value="{{ form.get('phone_number_main','') }}"
                        oninput="this.value=this.value.replace(/[^0-9]/g,'')"
                        class="{% if errors.phone %}input-error{% endif %}"
                        required>
                </div>
                {% if errors.phone %}<div class="error-text">{{ errors.phone }}</div>{% endif %}
            </div>

            <!-- SAME WHATSAPP -->
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="sameWhatsapp" name="same_whatsapp" checked>
                    <span>This is my WhatsApp number</span>
                </label>
            </div>

            <!-- WHATSAPP -->
            <div class="form-group" id="whatsappField" style="display:none;">
                <label>WhatsApp Number</label>
                <input type="text" id="whatsapp_number" name="whatsapp_number"
                    maxlength="10"
                    value="{{ form.get('whatsapp_number','') }}"
                    oninput="this.value=this.value.replace(/[^0-9]/g,'')">
                <div class="error-text" id="whatsappError" style="display:none;">
                    WhatsApp number must be different from mobile number
                </div>
            </div>

            <!-- BOARD -->
            <div class="form-group">
                <label>Board <span class="required">*</span></label>
                <select name="board" required>
                    <option value="">Select Board</option>
                    {% for b in ['CBSE','ICSE','State Board','IB','IGCSE','College'] %}
                    <option value="{{ b }}" {% if form.get('board') == b %}selected{% endif %}>{{ b }}</option>
                    {% endfor %}
                </select>
                {% if errors.board %}<div class="error-text">{{ errors.board }}</div>{% endif %}
            </div>

            <!-- GRADE -->
            <div class="form-group">
                <label>Grade <span class="required">*</span></label>
                <select name="grade" required>
                    <option value="">Select Grade</option>
                    {% for g in range(1,13) %}
                    <option value="{{ g }}" {% if form.get('grade')|int == g %}selected{% endif %}>{{ g }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- AGE -->
            <div class="form-group">
                <label>Age <span class="required">*</span></label>
                <input type="number" name="age" value="{{ form.get('age','') }}">
            </div>

            <!-- DOB -->
            <div class="form-group">
                <label>Date of Birth</label>
                <input type="date" name="dob" value="{{ form.get('dob','') }}">
            </div>

            <!-- CITY -->
            <div class="form-group">
                <label>City/Town(Nearest) <span class="required">*</span></label>
                <input type="text" name="city" value="{{ form.get('city','') }}">
            </div>

            <!-- POSTAL -->
            <div class="form-group">
                <label>Postal/ZIP Code <span class="required">*</span></label>
                <input type="text" name="postal_code" value="{{ form.get('postal_code','') }}">
            </div>

            <!-- TIMEZONE -->
            <div class="form-group">
                <label>Timezone</label>
                <select name="timezone">
                    <option value="">Select</option>
                    {% for tz in ['Asia/Kolkata','Europe/London','America/New_York','America/Los_Angeles'] %}
                    <option value="{{ tz }}" {% if form.get('timezone') == tz %}selected{% endif %}>{{ tz }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- PASSWORD -->
            <div class="form-group">
                <label>Password <span class="required">*</span></label>
                <input type="password" name="password" required>
                {% if errors.password %}<div class="error-text">{{ errors.password }}</div>{% endif %}
            </div>

            <!-- CONFIRM -->
            <div class="form-group">
                <label>Confirm Password <span class="required">*</span></label>
                <input type="password" name="confirm_password" required>
                {% if errors.confirm_password %}<div class="error-text">{{ errors.confirm_password }}</div>{% endif %}
            </div>

            <div class="form-group checkbox-group">
    <label class="checkbox-label">
        <input type="checkbox" name="whatsapp_consent">
        <span>I agree to receive messages on WhatsApp.</span>
    </label>
</div>

<div class="form-group checkbox-group">
    <label class="checkbox-label">
        <input type="checkbox" name="newsletter_consent">
        <span>Subscribe to newsletters, courses, and offers.</span>
    </label>
</div>


            <button class="register-btn">Register</button>

            <div class="or-divider">OR</div>

            <a href="{{ url_for('login_google') }}" class="google-btn">
                <img src="https://developers.google.com/identity/images/g-logo.png">
                Continue with Google
            </a>

        </form>
    </div>
</div>


<script>
const sameWhatsappCheckbox = document.getElementById("sameWhatsapp");
const whatsappGroup = document.getElementById("whatsappField");
const whatsappInput = document.getElementById("whatsapp_number");
const phoneInput = document.querySelector("input[name='phone_number_main']");
const whatsappError = document.getElementById("whatsappError");

sameWhatsappCheckbox.addEventListener("change", () => {
    whatsappGroup.style.display = sameWhatsappCheckbox.checked ? "none" : "block";
    whatsappInput.value = "";
    whatsappError.style.display = "none";
});

whatsappInput.addEventListener("input", () => {
    whatsappError.style.display =
        whatsappInput.value === phoneInput.value ? "block" : "none";
});
</script>
<script>
const phoneInput = document.querySelector("input[name='phone_number_main']");
let phoneErrorDiv = document.createElement("div");

phoneErrorDiv.className = "error-text";
phoneErrorDiv.style.display = "none";
phoneInput.parentElement.appendChild(phoneErrorDiv);

phoneInput.addEventListener("input", () => {
    phoneInput.value = phoneInput.value.replace(/\D/g, "");
    validatePhone();
});

function validatePhone() {
    const phone = phoneInput.value;

    phoneErrorDiv.style.display = "none";
    phoneInput.setCustomValidity("");

    // Must be exactly 10 digits
    if (phone.length !== 10) {
        return showError("Mobile number must be exactly 10 digits.");
    }

    // Must start with 6‚Äì9
    if (!/^[6-9]/.test(phone)) {
        return showError("Mobile number must start with 6, 7, 8, or 9.");
    }

    // Reject repeated digits
    if (/^(\d)\1{9}$/.test(phone)) {
        return showError("Invalid mobile number.");
    }

    // Reject obvious fake numbers
    const fakeNumbers = ["1234567890", "0123456789", "9876543210"];
    if (fakeNumbers.includes(phone)) {
        return showError("Invalid mobile number.");
    }

    return true;
}

function showError(msg) {
    phoneErrorDiv.innerText = msg;
    phoneErrorDiv.style.display = "block";
    phoneInput.setCustomValidity(msg);
    return false;
}
</script>


{% endblock %}
